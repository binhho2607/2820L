---
title: "FinalProject"
author: "Binh Ho"
date: "4/24/2022"
output: html_document
---

```{r}
library(ggplot2)
library(data.table)
library(tidyverse)
library(dplyr)

## Introduction

# Reading in all csv files as dataframes

equip_loss <- read.csv("russia_losses_equipment.csv")
exchange_rate <- read.csv("USD_RUB.csv")

## Explanation of how we altered data (weighted loss)

# Since equipment loss in the original dataset is cumulative, we calculated each value as a difference between it and the previous value, such that we could have equipment loss by day (not cumulative).

equip_loss = equip_loss %>%
  mutate(date = as.Date(date))
equip_loss$aircraft_per <- c(equip_loss$aircraft[1],diff(equip_loss$aircraft))
equip_loss$helicopter_per <- c(equip_loss$helicopter[1],diff(equip_loss$helicopter))
equip_loss$tank_per <- c(equip_loss$tank[1],diff(equip_loss$tank))
equip_loss$APC_per <- c(equip_loss$APC[1],diff(equip_loss$APC))
equip_loss$field_artillery_per <- c(equip_loss$field.artillery[1],diff(equip_loss$field.artillery))
equip_loss$MRL_per <- c(equip_loss$MRL[1],diff(equip_loss$MRL))
equip_loss$millitary_auto_per <- c(equip_loss$millitary.auto[1],diff(equip_loss$millitary.auto))
equip_loss$fuel_tank_per <- c(equip_loss$fuel.tank[1],diff(equip_loss$fuel.tank))
equip_loss$drone_per <- c(equip_loss$drone[1],diff(equip_loss$drone))
equip_loss$naval_ship_per <- c(equip_loss$naval.ship[1],diff(equip_loss$naval.ship))
equip_loss$anti_aircraft_warfare_per <- c(equip_loss$anti.aircraft.warfare[1],diff(equip_loss$anti.aircraft.warfare))
equip_loss$special_equipment_per <- c(equip_loss$special.equipment[1],diff(equip_loss$special.equipment))
equip_loss$mobile_SRBM_system_per <- c(equip_loss$mobile.SRBM.system[1],diff(equip_loss$mobile.SRBM.system))

# Calculated weighted loss based upon a formula that placed high value on losing expensive equipment

equip_loss$weighted_loss = c(equip_loss$tank*0.009 + equip_loss$aircraft*0.0716 + equip_loss$field_artillery_per*0.25 + equip_loss$helicopter*0.03444+equip_loss$naval_ship_per*0.6346)

# Makes modifications to exchange rate dataframe, converting the dates to a Date format, converting the change percentages to numbers rather than strings, and calculating real difference in exchange rate from day to day

exchange_rate = exchange_rate %>%
  mutate(Date = as.Date(Date, "%b %d %Y")) %>%
  mutate(Change = as.numeric(strsplit(Change.., "%"))) %>%
  mutate(date = Date, realchange = Price - Open)

head(equip_loss)
head(exchange_rate)

# We merge the two dataframes into one we will use for our analysis

full_frame <- full_join(equip_loss, exchange_rate, by = "date")
full_frame <- full_frame %>%
  filter(day < 51)
head(full_frame)
```
## Explanation of how we altered data (exchange rate)

```{r}
alt_pct = c(full_frame$Change[1], full_frame$Change[2])
alt_real = c(full_frame$realchange[1], full_frame$realchange[2])


for(i in 3:49){
  if((is.na(full_frame$realchange[i-2]))&(is.na(full_frame$realchange[i-1]))){
    pct_3 = full_frame$Change[i] / 3
    real_3 = full_frame$realchange[i] / 3
  } else{
    pct_3 = full_frame$Change[i]
    real_3 = full_frame$realchange[i]
  }
  alt_pct = c(alt_pct, pct_3)
  alt_real = c(alt_real, real_3)
}

head(full_frame)

for(i in 1:49){
  if(is.na(alt_real[i])){
    alt_pct[i] = alt_pct[i + 1]
    alt_real[i] = alt_real[i + 1]
  }
}

for(i in 1:49){
  if(is.na(alt_real[i])){
    alt_pct[i] = alt_pct[i + 1]
    alt_real[i] = alt_real[i + 1]
  }
}

full_frame <- mutate(full_frame, Change = alt_pct, realchange = alt_real)

## Statement of what analysis we will conduct

model <- lm(realchange ~ weighted_loss, data = full_frame)
summary(model)
cor(full_frame$weighted_loss, full_frame$realchange)^2
ggplot(full_frame, aes(weighted_loss, realchange)) + 
  geom_point() +
  geom_abline(slope = model$coefficients[2],
              intercept = model$coefficients[1])

## Stating results and what they mean

```